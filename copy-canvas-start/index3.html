<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <style>
        html,body{
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background:black;
            background:linear-gradient(to bottom,#dcdcdc 0%,palevioletred 100%);
        }
        #canvas{
            width: 100%;
            height: 100%;

        }
    </style>
    <title>测试</title>
</head>
<body>
<div >
    <canvas id='canvas' >浏览器不支持canvas</canvas>
</div>

<script>
    var testBox = function(){
        var canvas = document.getElementById("canvas"),
            ctx = canvas.getContext('2d'),
            Balls = [];
        var ball = function(x , y , vx , vy , useCache){
            this.x = x;
            this.y = y;
            this.vx = vx;
            this.vy = vy;
            this.r = getZ(getRandom(2,8));
            this.color = [];
            this.cacheCanvas = document.createElement("canvas");
            this.cacheCtx = this.cacheCanvas.getContext("2d");
            this.cacheCanvas.width = 2 *this.r;
            this.cacheCanvas.height = 2 *this.r;
            var alpha = ( Math.floor( Math.random() * 10 ) + 1)/ 10;
            this.color = "rgba(255,255,255," + alpha + ")";

            this.useCache = useCache;
            if(useCache){
                this.cache();
            }
        }

        function getZ(num){
            var rounded;
            rounded = (0.5 + num) | 0;
            // A double bitwise not.
            rounded = ~~ (0.5 + num);
            // Finally, a left bitwise shift.
            rounded = (0.5 + num) << 0;

            return rounded;
        }

        ball.prototype = {
            paint:function(ctx){
                if(!this.useCache){
                    ctx.save();
                    ctx.beginPath();
                    ctx.strokeStyle = this.color;
                    ctx.arc(this.x , this.y , 1, 0 , 2*Math.PI);
                    ctx.stroke();
                    ctx.restore();
                } else{
                    ctx.drawImage(this.cacheCanvas , this.x-this.r , this.y-this.r);
                }
            },

            cache:function(){
                this.cacheCtx.save();
                this.cacheCtx.beginPath();
                this.cacheCtx.strokeStyle = this.color;
                this.cacheCtx.arc(this.r , this.r , 1, 0 , 2*Math.PI);
                this.cacheCtx.stroke();
                this.cacheCtx.restore();
            },

            move:function(){
                this.y -= 0.25;
                if(this.y <= -10){
                    this.y += canvas.height + 10;
                }


                this.paint(ctx);
            }
        }

        var Game = {
            init:function(){
                for(var i=0;i<100;i++){
                    var b = new ball(getRandom(0,canvas.width) , getRandom(0,canvas.height) , getRandom(-10 , 10) ,  getRandom(-10 , 10) , true);
                    Balls.push(b);
                }
            },

            update:function(){
                ctx.clearRect(0,0,canvas.width,canvas.height);
                for(var i=0;i<Balls.length;i++){
                    Balls[i].move();
                }
            },

            loop:function(){
                var _this = this;
                this.update();
                RAF(function(){
                    _this.loop();
                })
            },

            start:function(){
                this.init();
                this.loop();
            }
        }

        window.RAF = (function(){
            return window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame || function (callback) {window.setTimeout(callback, 1000 / 60); };
        })();

        return Game;
    }();

    function getRandom(a , b){
        return Math.random()*(b-a)+a;
    }

    window.onload = function(){
        testBox.start();
    }
</script>
</body>
</html>